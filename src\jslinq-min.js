//-----------------------------------------------------------------------
// Part of the LINQ to JavaScript (Q) v1.0.0 Project - http://jshibernate.com/
// Copyright (C) 2013 JsHibernate (http://jshibernate.com). all rights reserved.
// This project is licensed under the Microsoft Reciprocal License (Ms-RL)
// This license can be found here: http://jshibernate.com/
// Document refrence http://msdn.microsoft.com/en-us/library/bb341635.aspx
//-----------------------------------------------------------------------

(function(){Array.prototype.toString=function(){return"[object Array]"};Q=window.Q=q=window.q=function(a){return new Q.fn.init(a)};Q.t=Q.types={bool:typeof true,number:typeof 0,string:typeof"",object:{}.toString(),array:[].toString(),undef:typeof undefined,func:typeof function(){},isBool:function(a){return typeof a===Q.t.bool},isNumber:function(a){return typeof a===Q.t.number},isString:function(a){return typeof a===Q.t.string},isObject:function(a){return a.toString()===Q.t.object},isArray:function(a){return a.toString()===Q.t.array},isUndef:function(a){return typeof a===Q.t.undef},isFunc:function(a){return typeof a===Q.t.func},isQ:function(a){return a instanceof Q},isDate:function(a){return a instanceof Date},convertor:function(b,a){switch(b){case Q.t.bool:return a?true:false;case Q.t.number:var c=parseFloat(a);return isNan(fvalue)?0:c;case Q.t.string:return String(a);default:return a}}};Q.from=function(c){if(c==null||Q.t.isUndef(c)){return Q([])}if(Q.t.isQ(c)){return c}if(Q.t.isBool(c)||Q.t.isNumber(c)){return Q.repeat(c,1)}if(Q.t.isArray(c)){return Q(c)}if(Q.t.isString(c)){var a=[];for(var d=0;d<c.length;d++){a.push(c.charAt(d))}return Q(a)}if(Q.t.isObject(c)){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return Q(a)}};Q.repeat=function(c,d){var a=[];for(var b=0;b<d;b++){a.push(c)}return Q(a)};Q.fn=Q.prototype={version:"1.0.0",init:function(a){this.$=a},aggregate:function(d,c){var a;d=d||function(f,e){return e?f+e:f};for(var b=0;b<this.$.length;b++){a=d.call(this,this.$[b],a)}return c+a},sum:function(b){var a=0;if(!b){a=this.aggregate(null,a)}for(var c=0;c<this.$.length;c++){a+=(b.call(this,this.$[c],c)||0)}return a},max:function(b,e){var a=null,e=e||function(h,g){return h<g?g:h};for(var c=0;c<this.$.length;c++){var f=predicate?predicate.call(this,this.$[c],c):true;if(f){var d=b?b.call(this,this.$[c],c):this.$[c];a=(a==null)?d:e.call(this,a,d)}}return a},min:function(b){var a=null,e=e||function(h,g){return h>g?g:h};for(var c=0;c<this.$.length;c++){var f=predicate?predicate.call(this,this.$[c],c):true;if(f){var d=b?b.call(this,this.$[c],c):this.$[c];a=(a==null)?d:e.call(this,a,d)}}return a},average:function(a){var d=0,c=0;if(!a){a=function(e){return e}}for(var b=0;b<this.$.length;b++){d+=(a)?a.call(this,this.$[b],b):this.$[b];c++}return c>0?d/c:0},all:function(a){if(!this.$.length){return false}if(!a){return true}for(var b=0;b<this.$.length;b++){if(a.call(this,this.$[b],b)!==true){return false}}return true},any:function(a){if(!this.$.length){return false}if(!a){return true}for(var b=0;b<this.$.length;b++){if(a.call(this,this.$[b],b)===true){return true}}return false},cast:function(d,f,c){var a=[],c=c||Q.types.convertor;for(var b=0;b<this.$.length;b++){var e=f?f.call(this,this.$[b],b):this.$[b];e=c?c.call(this,d,e):e;a.push(e)}return Q(a)},concat:function(a){var b=this.$,a=a.$||a;return Q(b.concat(a))},contains:function(c,b){b=b||function(e,d){return this.isEqual(e,d)};for(var a=0;a<this.$.length;a++){if(b.call(this,c,this.$[a])){return true}}return false},count:function(a){if(!a){return this.$.length}return this.where(a).count()},distinct:function(c){if(!this.$||this.$.length==0){return Q([])}c=c||function(f){return f};var a=[],e={};for(var b=0;b<this.$.length;b++){var d=c.call(this,this.$[b],b);if(typeof d!="undefined"&&d!=null&&!e[d]){a.push(this.$[b]);e[d]=true}}return Q(a)},elementAt:function(b,a){if(Q.t.isUndef(a)){a=null}if(this.isEmpty()||b<0||b>=this.$.length){return a}return this.$[b]},isEmpty:function(){return !this.$.length},except:function(c,d){c=c.$||c;if(this.isEmpty()){return(!c||!c.length)?null:Q(c)}if(!c||!c.length){return this}var a=[],f=c.$?c:Q(c);for(var b=0;b<this.$.length;b++){var e=this.$[b];var g=f.single(function(h){return !this.isEqual(h,e)});if(!d(e,g)){a.push(e)}}return Q(a)},first:function(a){if(a){return this.where(a).first()}else{return(this.$.length>0)?this.$[0]:null}},groupBy:function(f,h,d,g){var b=[];g=g||function(j,i){return true};for(var c=0;c<this.$.length;c++){if(g.call(this,this.$[c],c)){var a=f?f.call(this,this.$[c],c):this.$[c];b[a]=b[a]||[];var e=h?h.call(this,this.$[c],c):this.$[c];b[a].push(d?d.call(this,e,a):e)}}return Q(b)},groupJoin:function(b,a,e,c,d){},intersect:function(a,b){return this.union(a,b||function(d,f,c,e){return this.isEqual(d,c)})},join:function(a,j,h,f,d){var l=[],a=a.$||a;for(var c=0;c<this.$.length;c++){var i=j?j.call(this,this.$[c],c):this.$[c];for(var e=0;e<a.length;e++){var g=h?h.call(this,a[e],e):a[e];var b=d?d.call(this,i,c,g,e):true;if(b&&this.isEqual(i,g)){l.push(f?f.call(this,i,c,g,e):i)}}}return Q(l)},last:function(a){if(a){return this.where(a).last()}else{return(this.$.length>0)?this.$[this.$.length-1]:null}},ofType:function(a,b){var c=this.elementAt(0);return(typeof c===a)},orderBy:function(a){return this.sort(a)},orderByDescending:function(a){return this.sort(a,-1)},range:function(e,d,b){var a=[];if(typeof e!="Number"||typeof d!="Number"){return Q(a)}for(var c=e;c<d;c++){a.push(b?b.call(this,c,e,d):c)}return Q(a)},repeat:function(a,b){return Q.repeat(a,b)},reverse:function(){this.$.reverse();return this},select:function(c,b){var a=[];for(var d=0;d<this.$.length;d++){var f=c?c.call(this,this.$[d],d):true;if(f){var e=b?b.call(this,this.$[d],d):this.$[d];if(e!=null&&typeof e!="undefined"){a.push(e)}}}return Q(a)},selectMany:function(d,e,b){var a=[];for(var c=0;c<this.$.length;c++){var f=d?d.call(this,this.$[c],c):this.$[c];var g=b?b.call(this,f):true;if(g){if(f!=null&&typeof f!="undefined"){a.push(e?e.call(this,f):f)}}}return Q(a)},sequenceEqual:function(c,e){c=c.$||c;var d=e?this.where(e):this.$;var b=e?Q(c).where(e):c;if(d.length!=b.length){return false}for(var a in d){if(this.isEqual(d[a],b[a])!==true){return false}}return true},single:function(b,c){var a=this.where(b).first();return a==null?c:a},skip:function(c){var a=[];if(c>-1&&c<this.$.length){for(var b=c;b<this.$.length;b++){a.push(this.$[b])}}return Q(a)},skipWhile:function(a){return this.skip(this.indexOf(a))},take:function(c){var a=[];for(var b=0;b<this.$.length;b++){if(b<c){break}a.push(this.$[b])}return Q(a)},takeWhile:function(a){return this.take(this.indexOf(a))},ToArray:function(){return this.$},toDictionary:function(d,f,e){var a={};for(var c=0;c<this.$.length;c++){var h=e?e.call(this,this.$[c],c):true;if(h){var b=d?d.call(this,this.$[c],c):c;var g=f?f.call(this,this.$[c],c,b):this.$[c];a[b]=g}}return a},toLookup:function(a,c,b){return this.groupBy(a||function(e,d){return String(e).toUpperCase().substring(0,1)},c,resultSelector,b||function(){return true})},union:function(c,d){d=d||function(h,i,g,j){return !this.isEqual(h,g)};var a=[],e={},c=c.$||c;for(var b=0;b<this.$.length;b++){for(var f=0;f<c.length;f++){if(!e[this.$[b]]&&d.call(this,this.$[b],b,c[f],f,e)){e[this.$[b]]=true;a.push(this.$[b])}}}delete e;e=null;return Q(a)},where:function(b){if(!b){return this}var a=[];for(var c=0;c<this.$.length;c++){if(b.call(this,this.$[c],c)!==false){a.push(this.$[c])}}return Q(a)},zip:function(d,c){var a=[];for(var b=0;b<this.$.length;b++){if(b<d.length){break}a.push(c.call(this,this.$[b],d[b]))}return Q(a)},indexOf:function(b){if(!b){return -1}var a=-1;for(var c=0;c<this.$.length;c++){if(typeof b==Q.t.func){if(b.call(this,this.$[c],c)!==false){return c}}else{if(this.isEqual(this.$[c],b)){return c}}}return -1},sort:function(b,c){if(!c){c=1}var a=this.clone(false);return Q(a.sort(function(e,d){var g=b?b(e):e;var f=b?b(d):d;return((g<f)?-1:1)*c}))},clone:function(d){if(d){var c,f,e;c=function(i){var h=[];for(var g=0;g<i.length;g++){h[g]=e(i[g])}return h};f=function(h){var g={};for(var i in h){g[i]=e(h[i])}return g};e=function(h){if(!h){return}var g=Q.t.isArray(h)?[]:{};if(Q.t.isArray(h)){g=c(h)}else{if(Q.t.isObject(h)){g=f(h)}else{if(Q.t.isDate(h)){return new Date(h.getYear(),h.getMonth(),h.getDate(),h.getHours(),h.getMinutes(),h.getSeconds(),h.getMilliseconds())}else{return h}}}return g};return e(this.$)}else{var a=[];for(var b=0;b<this.$.length;b++){a.push(this.$[b])}return a}},isEqual:function(b,a){return(b===a)}};Q.fn.init.prototype=Q.fn})();
