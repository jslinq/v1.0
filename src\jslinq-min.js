//-----------------------------------------------------------------------
// Part of the LINQ to JavaScript (JSLINQ) v1.0.0 Project - http://jshibernate.com/JSLINQ/
// Copyright (C) 2013 JsHibernate (http://jshibernate.com). All rights reserved.
// This project is licensed under the Microsoft Reciprocal License (Ms-RL)
// This license can be found here: http://jshibernate.com/JSLINQ/license
// Document refrence http://msdn.microsoft.com/en-us/library/bb341635.aspx
//-----------------------------------------------------------------------
(function(){JSLINQ=window.JSLINQ=function(e){return new JSLINQ.fn.init(e)};JSLINQ.Types={Boolean:typeof true,Number:typeof 0,String:typeof "",Object:typeof {},Array:typeof [],Undefined:typeof undefined,Function:typeof function(){},TypeConvertor:function(e,t){switch(e){case JSLINQ.Types.Boolean:return t?true:false;case JSLINQ.Types.Number:var n=parseFloat(t);return isNan(n)?0:n;case JSLINQ.Types.String:return String(t);default:return t}}};JSLINQ.from=function(e){if(e==null||typeof e==JSLINQ.Types.Undefined)return JSLINQ([]);if(e instanceof JSLINQ)return e;if(typeof e==JSLINQ.Types.Number||typeof e==JSLINQ.Types.Boolean)return JSLINQ.Repeat(e,1);if(typeof e==JSLINQ.Types.Array)return JSLINQ(e);if(typeof e==JSLINQ.Types.String){var t=[];for(var n=0;n<e.length;n++)t.push(e.charAt(n));return JSLINQ(t)}};JSLINQ.Repeat=function(e,t){var n=[];for(var r=0;r<t;r++)n.push(e);return JSLINQ(n)};JSLINQ.fn=JSLINQ.prototype={version:"1.0.0",init:function(e){this.source=e},Aggregate:function(e,t){var n;e=e||function(e,t){return t?e+t:e};for(var r in this.source){n=e.call(this,this.source[r],n)}return t+n},All:function(e){if(!this.source.length)return false;if(!e)return true;for(var t in this.source){if(e.call(this,this.source[t],t)!==true)return false}return true},Any:function(e){if(!this.source.length)return false;if(!e)return true;for(var t in this.source){if(e.call(this,this.source[t],t)===true)return true}return false},Average:function(e){var t=0,n=0;if(!e)e=function(e){return e};for(var r in this.source){t+=e?e.call(this,this.source[r],r):this.source[r];n++}return n>0?t/n:0},Cast:function(e,t,n){var r=[],n=n||JSLINQ.Types.TypeConvertor;for(var i in this.source){var s=t?t.call(this,this.source[i],i):this.source[i];s=n?n.call(this,e,s):s;r.push(s)}return JSLINQ(r)},Concat:function(e){var t=this.source,e=e.source||e;return new JSLINQ(t.concat(e))},Contains:function(e,t){t=t||function(e,t){return this.IsEqual(e,t)};for(var n in this.source){if(t.call(this,e,this.source[n]))return true}return false},Count:function(e){if(!e)return this.source.length;return this.Where(e).Count()},DefaultIfEmpty:function(e){if(!this.source||this.source.length==0)return e;return this},Distinct:function(e){if(!this.source||this.source.length==0)return JSLINQ([]);e=e||function(e){return e};var t=[],n={};for(var r in this.source){var i=e.call(this,this.source[r],r);if(typeof i!="undefined"&&i!=null&&!n[i]){t.push(this.source[r]);n[i]=true}}return JSLINQ(t)},ElementAt:function(e){if(this.IsEmpty()||e<0||e>=this.source.length)return null;return this.source[e]},ElementAtOrDefault:function(e){var t=this.ElementAt(e);return t},IsEmpty:function(){return!this.source.length},Except:function(e,t){e=e.source||e;if(this.IsEmpty())return!e||!e.length?null:JSLINQ(e);if(!e||!e.length)return this;var n=[],r=e.source?e:JSLINQ(e);for(var i in this.source){var s=this.source[i];var o=r.Single(function(e){return!this.IsEqual(e,s)});if(!t(s,o)){n.push(s)}}return JSLINQ(n)},First:function(e){if(e)return this.Where(e).First();else return this.source.length>0?this.source[0]:null},FirstOrDefault:function(e,t){var n=this.First(t);if(!n)n="";return n},GroupBy:function(e,t,n,r){var i=[];r=r||function(e,t){return true};for(var s in this.source){if(r.call(this,this.source[s],s)){var o=e?e.call(this,this.source[s],s):this.source[s];i[o]=i[o]||[];var u=t?t.call(this,this.source[s],s):this.source[s];i[o].push(n?n.call(this,u,o):u)}}return JSLINQ(i)},GroupJoin:function(e,t,n,r,i){},Intersect:function(e,t){return this.Union(e,t||function(e,t,n,r){return this.IsEqual(e,n)})},Join:function(e,t,n,r,i){var s=[],e=e.source||e;for(var o in this.source){var u=t?t.call(this,this.source[o],o):this.source[o];for(var a in e){var f=n?n.call(this,e[a],a):e[a];var l=i?i.call(this,u,o,f,a):true;if(l&&this.IsEqual(u,f)){s.push(r?r.call(this,u,o,f,a):u)}}}return JSLINQ(s)},Last:function(e){if(e){return this.Where(e).Last()}else{return this.source.length>0?this.source[this.source.length-1]:null}},LastOrDefault:function(e,t){return this.Last(t)},Max:function(e,t){var n=null,t=t||function(e,t){return e<t?t:e};for(var r in this.source){var i=predicate?predicate.call(this,this.source[r],r):true;if(i){var s=e?e.call(this,this.source[r],r):this.source[r];n=n==null?s:t.call(this,n,s)}}return n},Min:function(e){var t=null,n=n||function(e,t){return e>t?t:e};for(var r in this.source){var i=predicate?predicate.call(this,this.source[r],r):true;if(i){var s=e?e.call(this,this.source[r],r):this.source[r];t=t==null?s:n.call(this,t,s)}}return t},OfType:function(e,t){var n=this.ElementAt(0);return typeof n===e},OrderBy:function(e){return this.Sort(e)},OrderByDescending:function(e){return this.Sort(e,-1)},Range:function(e,t,n){var r=[];if(typeof e!="Number"||typeof t!="Number")return JSLINQ(r);for(var i=e;i<t;i++){r.push(n?n.call(this,i,e,t):i)}return JSLINQ(r)},Repeat:function(e,t){return JSLINQ.Repeat(e,t)},Reverse:function(){var e=[];for(var t=this.source.length-1;t>-1;t--)e.push(this.source[t]);return JSLINQ(e)},Select:function(e,t){var n=[];for(var r in this.source){var i=e?e.call(this,this.source[r],r):true;if(i){var s=t?t.call(this,this.source[r],r):this.source[r];if(s!=null&&typeof s!="undefined")n.push(s)}}return JSLINQ(n)},SelectMany:function(e,t,n){var r=[];for(var i in this.source){var s=e?e.call(this,this.source[i],i):this.source[i];var o=n?n.call(this,s):true;if(o){if(s!=null&&typeof s!="undefined")r.push(t?t.call(this,s):s)}}return JSLINQ(r)},SequenceEqual:function(e,t){e=e.source||e;var n=t?this.Where(t):this.source;var r=t?JSLINQ(e).Where(t):e;if(n.length!=r.length)return false;for(var i in n){if(this.IsEqual(n[i],r[i])!==true)return false}return true},Single:function(e){return this.Where(e).First()},SingleOrDefault:function(e){return this.Single(e)},Skip:function(e){var t=[];if(e>-1&&e<this.source.length){for(var n=e;n<this.source.length;n++)t.push(this.source[n])}return JSLINQ(t)},SkipWhile:function(e){return this.Skip(this.IndexOf(e))},Sum:function(e){var t=0;if(!e)t=this.Aggregate(null,t);for(var n in this.source)t+=e.call(this,this.source[n],n)||0;return t},Take:function(e){var t=[];for(var n in this.source){if(n<e)break;t.push(this.source[n])}return JSLINQ(t)},TakeWhile:function(e){return this.Take(this.IndexOf(e))},ThenBy:function(e,t){},ThenByDescending:function(e,t){},ToArray:function(){return this.source},ToDictionary:function(e,t,n){var r={};for(var i in this.source){var s=n?n.call(this,this.source[i],i):true;if(s){var o=e?e.call(this,this.source[i],i):i;var u=t?t.call(this,this.source[i],i,o):this.source[i];r[o]=u}}return r},ToList:function(){return this.ToArray()},ToLookup:function(e,t,n){return this.GroupBy(e||function(e,t){return String(e).toUpperCase().substring(0,1)},t,resultSelector,n||function(){return true})},Union:function(e,t){t=t||function(e,t,n,r){return!this.IsEqual(e,n)};var n=[],r={},e=e.source||e;for(var i in this.source){for(var s in e){if(!r[this.source[i]]&&t.call(this,this.source[i],i,e[s],s,r)){r[this.source[i]]=true;n.push(this.source[i])}}}delete r;r=null;return JSLINQ(n)},Where:function(e){if(!e)return this;var t=[];for(var n in this.source){if(e.call(this,this.source[n],n)!==false){t.push(this.source[n])}}return JSLINQ(t)},Zip:function(e,t){var n=[];for(var r in this.source){if(r<e.length)break;n.push(t.call(this,this.source[r],e[r]))}return JSLINQ(n)},IndexOf:function(e){if(!e)return-1;var t=-1;for(var n in this.source){if(e.call(this,this.source[n],n)!==false)return n}return-1},Sort:function(e,t){if(!t)t=1;var n=this.Copy(false);return JSLINQ(n.sort(function(n,r){var i=e?e(n):n;var s=e?e(r):r;return(i<s?-1:1)*t}))},Copy:function(e){if(e){var t=function(e){var t={};for(var r in e){t[r]=n(e[r])}return t};var n=function(e){if(!e)return;var n=typeof e==JSLINQ.Types.Array?[]:{};if(typeof e==JSLINQ.Types.Array)n=t(e);else if(typeof e=="Object")n=t(e);else return e;return n};return n(this.source)}else{var r=[];for(var i in this.source)r.push(this.source[i]);return r}},IsEqual:function(e,t){return e===t}};JSLINQ.fn.init.prototype=JSLINQ.fn})()
